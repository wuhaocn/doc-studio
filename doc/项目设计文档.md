# DocStudio - 在线文档管理系统设计文档

## 1. 项目概述

### 1.1 项目名称
DocStudio - 在线文档管理系统

### 1.2 项目简介
DocStudio 是一个类似飞书风格的在线文档管理系统，提供简洁直观的界面和流畅的文档编辑体验。系统采用前后端分离架构，前端基于 React 框架构建，后端基于 Java Spring Boot 构建，支持知识库管理、文档管理、富文本编辑和协作功能。

**核心概念**:
- **知识库（Knowledge Base）**: 文档的容器，用于组织和分类文档
- **文档（Document）**: 属于某个知识库的具体文档内容

### 1.3 项目目标
- 提供类似飞书风格的简洁用户界面
- 实现知识库的创建、管理和组织功能
- 实现文档的创建、编辑、存储和管理功能
- 支持知识库-文档的层级结构管理
- 支持富文本编辑和格式化
- 提供良好的用户体验和响应式设计
- 实现前后端分离，支持分布式部署
- 提供可扩展的后端服务架构

### 1.4 系统架构
```
┌─────────────────┐
│   前端应用       │
│  doc-web-app    │
│   (React)       │
└────────┬────────┘
         │ HTTP/HTTPS
         │ RESTful API
┌────────▼────────┐
│   后端服务       │
│   doc-server    │
│  (Spring Boot)  │
└────────┬────────┘
         │
┌────────▼────────┐
│   数据存储       │
│  MySQL/Redis    │
└─────────────────┘
```

## 2. 前端设计

### 2.1 前端技术栈
- **框架**: React 18
- **路由**: React Router v6
- **状态管理**: Redux Toolkit / Zustand
- **UI组件库**: Arco Design（推荐）/ shadcn/ui + Radix UI
  - Arco Design：字节跳动开源，风格简洁现代，更接近飞书设计语言
  - shadcn/ui：基于 Radix UI，无样式组件，可完全自定义，灵活性高
- **文档编辑器**: Tiptap（推荐）/ BlockNote
  - Tiptap：基于 ProseMirror，功能强大、API友好，扩展性强，适合复杂文档编辑
  - BlockNote：基于 Tiptap，专为 Notion 风格设计，开箱即用的块编辑器
- **HTTP客户端**: Axios
- **样式方案**: CSS Modules / Styled Components
- **构建工具**: Vite / Create React App
- **代码规范**: ESLint + Prettier

### 2.2 前端项目结构
```
doc-web-app/
├── public/
│   ├── index.html
│   ├── favicon.ico
│   └── assets/
├── src/
│   ├── components/          # 通用组件
│   │   ├── Layout/
│   │   │   ├── Layout.jsx
│   │   │   ├── Header.jsx
│   │   │   ├── Sidebar.jsx
│   │   │   └── Layout.module.css
│   │   ├── Editor/
│   │   │   ├── RichTextEditor.jsx
│   │   │   ├── Toolbar.jsx
│   │   │   └── Editor.module.css
│   │   ├── DocumentList/
│   │   │   ├── DocumentList.jsx
│   │   │   ├── DocumentItem.jsx
│   │   │   └── DocumentList.module.css
│   │   ├── DocumentTree/
│   │   │   ├── DocumentTree.jsx
│   │   │   ├── TreeNode.jsx
│   │   │   └── DocumentTree.module.css
│   │   ├── KnowledgeBase/
│   │   │   ├── KnowledgeBaseList.jsx
│   │   │   ├── KnowledgeBaseItem.jsx
│   │   │   ├── KnowledgeBaseTree.jsx
│   │   │   └── KnowledgeBase.module.css
│   │   ├── Search/
│   │   │   ├── SearchBar.jsx
│   │   │   └── SearchResults.jsx
│   │   └── Common/
│   │       ├── Button.jsx
│   │       ├── Modal.jsx
│   │       └── Loading.jsx
│   ├── pages/               # 页面组件
│   │   ├── Home/
│   │   │   ├── Home.jsx
│   │   │   └── Home.module.css
│   │   ├── Document/
│   │   │   ├── DocumentDetail.jsx
│   │   │   ├── DocumentEdit.jsx
│   │   │   └── Document.module.css
│   │   ├── KnowledgeBase/
│   │   │   ├── KnowledgeBaseDetail.jsx
│   │   │   ├── KnowledgeBaseEdit.jsx
│   │   │   └── KnowledgeBase.module.css
│   │   ├── Login/
│   │   │   ├── Login.jsx
│   │   │   └── Login.module.css
│   │   └── NotFound/
│   │       └── NotFound.jsx
│   ├── store/               # 状态管理
│   │   ├── slices/
│   │   │   ├── documentSlice.js
│   │   │   ├── knowledgeBaseSlice.js
│   │   │   ├── userSlice.js
│   │   │   └── uiSlice.js
│   │   └── store.js
│   ├── services/            # API服务
│   │   ├── api/
│   │   │   ├── documentApi.js
│   │   │   ├── knowledgeBaseApi.js
│   │   │   ├── userApi.js
│   │   │   └── authApi.js
│   │   ├── http/
│   │   │   ├── axios.js
│   │   │   └── interceptors.js
│   │   └── constants.js
│   ├── hooks/               # 自定义Hooks
│   │   ├── useDocument.js
│   │   ├── useKnowledgeBase.js
│   │   ├── useAuth.js
│   │   └── useDebounce.js
│   ├── utils/               # 工具函数
│   │   ├── constants.js
│   │   ├── helpers.js
│   │   └── validators.js
│   ├── styles/              # 全局样式
│   │   ├── variables.css
│   │   ├── reset.css
│   │   └── global.css
│   ├── router/              # 路由配置
│   │   └── index.jsx
│   ├── App.jsx
│   └── index.js
├── .env.development
├── .env.production
├── package.json
├── vite.config.js
└── README.md
```

### 2.3 前端页面设计

#### 2.3.1 登录页面
**路由**: `/login`

**功能**:
- 用户登录表单（用户名/邮箱、密码）
- 记住我选项
- 忘记密码链接
- 注册入口

**UI设计**:
- 居中布局，简洁表单
- 品牌Logo展示
- 响应式设计，适配移动端

#### 2.3.2 首页（知识库列表页）
**路由**: `/`

**功能**:
- 顶部搜索栏
- 左侧知识库树导航
- 主内容区显示知识库列表
- 新建知识库按钮
- 知识库筛选（全部、我的、最近、收藏）
- 知识库排序（时间、名称）

**UI设计**:
- 三栏布局：侧边栏 + 列表区 + 详情预览（可选）
- 卡片式知识库展示
- 悬停效果和操作按钮

#### 2.3.3 知识库详情页
**路由**: `/kb/:id`

**功能**:
- 知识库信息展示（名称、描述、创建时间等）
- 知识库下的文档列表
- 新建文档按钮
- 文档筛选和排序
- 知识库设置（重命名、删除、分享等）

**UI设计**:
- 左侧显示知识库树
- 主内容区显示文档列表
- 支持文档拖拽排序

#### 2.3.5 文档编辑页
**路由**: `/kb/:kbId/doc/:id` 或 `/kb/:kbId/doc/new`

**功能**:
- 顶部工具栏（保存、导出、分享等）
- 文档标题编辑
- 富文本编辑器
- 右侧属性面板（可选）
- 自动保存提示
- 版本历史查看
- 显示所属知识库信息

**UI设计**:
- 类似飞书的编辑界面
- 工具栏固定在顶部
- 编辑器居中，最大宽度限制
- 实时保存状态提示

#### 2.3.6 文档详情页
**路由**: `/kb/:kbId/doc/:id/view`

**功能**:
- 文档只读展示
- 评论功能
- 分享功能
- 导出功能
- 显示所属知识库信息

### 2.4 知识库层级结构说明

#### 2.4.1 层级关系
系统采用**知识库 -> 文档**的两级层级结构：
- **知识库（Knowledge Base）**: 顶层容器，用于组织和分类文档
  - 每个知识库有独立的名称、描述、封面等信息
  - 用户可以创建多个知识库
  - 知识库可以设置公开/私有
- **文档（Document）**: 属于某个知识库的具体文档内容
  - 每个文档必须属于一个知识库
  - 文档可以在知识库内形成树形结构（通过parent_id）
  - 文档可以移动到其他知识库

#### 2.4.2 数据组织方式
```
用户
  ├── 知识库A
  │   ├── 文档1
  │   ├── 文档2
  │   │   └── 文档2.1（子文档）
  │   └── 文档3
  ├── 知识库B
  │   ├── 文档4
  │   └── 文档5
  └── 知识库C
      └── 文档6
```

#### 2.4.3 功能特性
- **知识库管理**: 创建、编辑、删除、归档知识库
- **文档归属**: 文档必须属于某个知识库，创建时指定
- **文档移动**: 支持将文档从一个知识库移动到另一个知识库
- **层级导航**: 侧边栏显示知识库树，点击知识库显示其下的文档列表
- **搜索范围**: 可以全局搜索，也可以限定在某个知识库内搜索

### 2.5 前端核心组件设计

#### 2.5.1 Layout 布局组件
- **Header**: 顶部导航栏，包含用户信息、通知、设置
- **Sidebar**: 左侧边栏，包含知识库树、快捷操作
- **MainContent**: 主内容区域，动态渲染页面内容

#### 2.5.2 RichTextEditor 富文本编辑器
- 基于 React-Quill 或 Slate.js
- 支持标题、列表、链接、图片、表格等
- 工具栏可配置
- 支持快捷键
- 自动保存功能

#### 2.5.3 DocumentList 文档列表
- 列表/网格视图切换
- 文档卡片展示（标题、预览、时间、作者）
- 批量操作（删除、移动、分享）
- 无限滚动或分页加载

#### 2.5.4 DocumentTree 文档树
- 树形结构展示
- 拖拽排序
- 展开/折叠节点
- 右键菜单（新建、重命名、删除）

#### 2.5.5 KnowledgeBaseTree 知识库树
- 知识库树形结构展示（知识库 -> 文档）
- 拖拽文档到不同知识库
- 展开/折叠知识库节点
- 右键菜单（新建知识库、新建文档、重命名、删除）
- 显示知识库下的文档数量

#### 2.5.6 KnowledgeBaseList 知识库列表
- 知识库卡片展示（名称、描述、文档数量、创建时间）
- 网格/列表视图切换
- 批量操作（删除、分享、归档）
- 无限滚动或分页加载

### 2.6 前端路由设计
```
/                          # 首页（知识库列表）
/login                     # 登录页
/register                  # 注册页
/kb                        # 知识库列表页
/kb/new                    # 新建知识库
/kb/:id                    # 知识库详情页（显示该知识库下的文档列表）
/kb/:id/settings           # 知识库设置页
/kb/:kbId/doc              # 文档列表页（指定知识库下）
/kb/:kbId/doc/new          # 新建文档（指定知识库下）
/kb/:kbId/doc/:id          # 文档编辑页
/kb/:kbId/doc/:id/view     # 文档查看页
/kb/:kbId/doc/:id/history  # 文档历史版本
/settings                  # 设置页
/profile                   # 个人资料
/search                    # 搜索结果页
```

### 2.7 前端状态管理
- **知识库状态**: 知识库列表、当前知识库、知识库树结构
- **文档状态**: 文档列表、当前文档、编辑状态
- **用户状态**: 用户信息、登录状态、权限
- **UI状态**: 侧边栏展开/收起、主题、加载状态

### 2.8 前端API接口设计
```
# 知识库相关
GET    /api/knowledge-bases              # 获取知识库列表
GET    /api/knowledge-bases/:id          # 获取知识库详情
POST   /api/knowledge-bases              # 创建知识库
PUT    /api/knowledge-bases/:id          # 更新知识库
DELETE /api/knowledge-bases/:id          # 删除知识库
GET    /api/knowledge-bases/:id/documents # 获取知识库下的文档列表
POST   /api/knowledge-bases/:id/duplicate # 复制知识库

# 文档相关
GET    /api/documents                    # 获取文档列表（可指定知识库ID）
GET    /api/documents/:id                # 获取文档详情
POST   /api/documents                    # 创建文档（需指定知识库ID）
PUT    /api/documents/:id                # 更新文档
DELETE /api/documents/:id                # 删除文档
POST   /api/documents/:id/duplicate      # 复制文档
PUT    /api/documents/:id/move           # 移动文档到其他知识库
Body: { knowledgeBaseId }

# 用户相关
POST   /api/auth/login                   # 登录
POST   /api/auth/logout                  # 登出
POST   /api/auth/register                # 注册
GET    /api/user/profile                 # 获取用户信息

# 搜索相关
GET    /api/search                       # 搜索（知识库和文档）
Query参数: keyword, type(kb/doc), page, size
```

## 3. 后端设计

### 3.1 后端技术栈
- **框架**: Spring Boot 2.7+ / 3.0+
- **数据库**: MySQL 8.0+
- **缓存**: Redis 6.0+
- **ORM**: MyBatis Plus / JPA
- **安全**: Spring Security + JWT
- **文档**: Swagger / Knife4j
- **消息队列**: RabbitMQ / RocketMQ（可选）
- **文件存储**: MinIO / OSS（可选）

### 3.2 后端项目结构（多模块Maven项目）

```
doc-server/
├── doc-server-manager/          # 管理模块（核心业务逻辑）
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── com/docstudio/
│   │   │   │       ├── manager/
│   │   │   │       │   ├── controller/      # 控制器层
│   │   │   │       │   │   ├── DocumentController.java
│   │   │   │       │   │   ├── KnowledgeBaseController.java
│   │   │   │       │   │   ├── UserController.java
│   │   │   │       │   │   └── SearchController.java
│   │   │   │       │   ├── service/         # 服务层
│   │   │   │       │   │   ├── DocumentService.java
│   │   │   │       │   │   ├── KnowledgeBaseService.java
│   │   │   │       │   │   ├── UserService.java
│   │   │   │       │   │   └── SearchService.java
│   │   │   │       │   ├── mapper/          # 数据访问层
│   │   │   │       │   │   ├── DocumentMapper.java
│   │   │   │       │   │   ├── KnowledgeBaseMapper.java
│   │   │   │       │   │   └── UserMapper.java
│   │   │   │       │   ├── entity/          # 实体类
│   │   │   │       │   │   ├── Document.java
│   │   │   │       │   │   ├── KnowledgeBase.java
│   │   │   │       │   │   ├── User.java
│   │   │   │       │   │   └── DocumentVersion.java
│   │   │   │       │   ├── dto/             # 数据传输对象
│   │   │   │       │   │   ├── DocumentDTO.java
│   │   │   │       │   │   ├── KnowledgeBaseDTO.java
│   │   │   │       │   │   └── UserDTO.java
│   │   │   │       │   ├── vo/              # 视图对象
│   │   │   │       │   │   ├── DocumentVO.java
│   │   │   │       │   │   └── KnowledgeBaseVO.java
│   │   │   │       │   ├── enums/           # 枚举类
│   │   │   │       │   │   ├── DocumentStatus.java
│   │   │   │       │   │   └── KnowledgeBaseStatus.java
│   │   │   │       │   └── config/          # 配置类
│   │   │   │       │       └── MyBatisConfig.java
│   │   │   │       └── resources/
│   │   │   │           └── mapper/
│   │   │   │               ├── DocumentMapper.xml
│   │   │   │               ├── KnowledgeBaseMapper.xml
│   │   │   │               └── UserMapper.xml
│   │   │   └── test/
│   │   └── pom.xml
│   │
├── doc-server-start/             # 启动模块（应用入口）
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── com/docstudio/
│   │   │   │       ├── DocStudioApplication.java  # 启动类
│   │   │   │       ├── config/                    # 全局配置
│   │   │   │       │   ├── WebConfig.java
│   │   │   │       │   ├── SecurityConfig.java
│   │   │   │       │   ├── RedisConfig.java
│   │   │   │       │   └── SwaggerConfig.java
│   │   │   │       ├── filter/                    # 过滤器
│   │   │   │       │   └── JwtAuthenticationFilter.java
│   │   │   │       ├── interceptor/               # 拦截器
│   │   │   │       │   └── AuthInterceptor.java
│   │   │   │       └── exception/                 # 异常处理
│   │   │   │           └── GlobalExceptionHandler.java
│   │   │   └── resources/
│   │   │       ├── application.yml
│   │   │       ├── application-dev.yml
│   │   │       ├── application-prod.yml
│   │   │       └── logback-spring.xml
│   │   └── test/
│   └── pom.xml
│
├── doc-server-common/            # 公共模块（可选）
│   ├── src/
│   │   └── main/
│   │       └── java/
│   │           └── com/docstudio/
│   │               ├── common/
│   │               │   ├── constant/        # 常量
│   │               │   ├── util/            # 工具类
│   │               │   ├── result/          # 统一响应
│   │               │   └── exception/       # 异常定义
│   │   └── pom.xml
│
└── pom.xml                       # 父POM
```

### 3.3 后端模块说明

#### 3.3.1 doc-server-manager（管理模块）
**职责**: 核心业务逻辑模块
- 文档管理业务逻辑
- 用户管理业务逻辑
- 数据访问层（Mapper）
- 业务服务层（Service）
- 控制器层（Controller）

**主要功能**:
- 知识库CRUD操作
- 文档CRUD操作
- 知识库-文档层级关系管理
- 文档版本管理
- 用户认证授权
- 知识库和文档搜索
- 知识库和文档分享和权限管理

#### 3.3.2 doc-server-start（启动模块）
**职责**: 应用启动和全局配置
- Spring Boot 启动类
- 全局配置（安全、跨域、数据库等）
- 过滤器、拦截器配置
- 异常处理
- 日志配置

**依赖关系**: 依赖 `doc-server-manager` 模块

#### 3.3.3 doc-server-common（公共模块）
**职责**: 公共工具和通用类
- 统一响应结果封装
- 工具类
- 常量定义
- 异常定义

**依赖关系**: 被其他模块依赖

### 3.4 数据库设计

#### 3.4.1 知识库表（knowledge_base）
```sql
CREATE TABLE `knowledge_base` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `name` VARCHAR(100) NOT NULL COMMENT '知识库名称',
  `description` VARCHAR(500) COMMENT '知识库描述',
  `cover` VARCHAR(255) COMMENT '封面图片',
  `user_id` BIGINT NOT NULL COMMENT '创建者ID',
  `status` TINYINT DEFAULT 1 COMMENT '1:正常 0:删除 2:归档',
  `is_public` TINYINT DEFAULT 0 COMMENT '是否公开',
  `document_count` INT DEFAULT 0 COMMENT '文档数量',
  `view_count` INT DEFAULT 0 COMMENT '查看次数',
  `sort_order` INT DEFAULT 0 COMMENT '排序顺序',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_status` (`status`),
  INDEX `idx_created_at` (`created_at`)
);
```

#### 3.4.2 用户表（user）
```sql
CREATE TABLE `user` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `username` VARCHAR(50) UNIQUE NOT NULL,
  `email` VARCHAR(100) UNIQUE NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `nickname` VARCHAR(50),
  `avatar` VARCHAR(255),
  `status` TINYINT DEFAULT 1 COMMENT '1:正常 0:禁用',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 3.4.3 文档表（document）
```sql
CREATE TABLE `document` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `title` VARCHAR(200) NOT NULL,
  `content` LONGTEXT COMMENT '文档内容HTML',
  `content_text` TEXT COMMENT '纯文本内容，用于搜索',
  `knowledge_base_id` BIGINT NOT NULL COMMENT '所属知识库ID',
  `user_id` BIGINT NOT NULL COMMENT '创建者ID',
  `parent_id` BIGINT DEFAULT 0 COMMENT '父文档ID，0表示根目录（同一知识库内）',
  `status` TINYINT DEFAULT 1 COMMENT '1:正常 0:删除',
  `is_public` TINYINT DEFAULT 0 COMMENT '是否公开',
  `view_count` INT DEFAULT 0 COMMENT '查看次数',
  `sort_order` INT DEFAULT 0 COMMENT '排序顺序',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX `idx_knowledge_base_id` (`knowledge_base_id`),
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_parent_id` (`parent_id`),
  INDEX `idx_created_at` (`created_at`),
  FOREIGN KEY (`knowledge_base_id`) REFERENCES `knowledge_base`(`id`) ON DELETE CASCADE
);
```

#### 3.4.4 文档版本表（document_version）
```sql
CREATE TABLE `document_version` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `document_id` BIGINT NOT NULL,
  `version` INT NOT NULL COMMENT '版本号',
  `content` LONGTEXT,
  `user_id` BIGINT NOT NULL COMMENT '操作人ID',
  `change_log` VARCHAR(500) COMMENT '变更说明',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX `idx_document_id` (`document_id`)
);
```

#### 3.4.5 文档分享表（document_share）
```sql
CREATE TABLE `document_share` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `document_id` BIGINT NOT NULL,
  `share_code` VARCHAR(32) UNIQUE NOT NULL COMMENT '分享码',
  `share_type` TINYINT DEFAULT 1 COMMENT '1:公开 2:密码',
  `password` VARCHAR(50),
  `expire_at` DATETIME COMMENT '过期时间',
  `created_by` BIGINT NOT NULL,
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX `idx_share_code` (`share_code`)
);
```

#### 3.4.6 知识库分享表（knowledge_base_share）
```sql
CREATE TABLE `knowledge_base_share` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `knowledge_base_id` BIGINT NOT NULL,
  `share_code` VARCHAR(32) UNIQUE NOT NULL COMMENT '分享码',
  `share_type` TINYINT DEFAULT 1 COMMENT '1:公开 2:密码',
  `password` VARCHAR(50),
  `expire_at` DATETIME COMMENT '过期时间',
  `created_by` BIGINT NOT NULL,
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX `idx_share_code` (`share_code`),
  FOREIGN KEY (`knowledge_base_id`) REFERENCES `knowledge_base`(`id`) ON DELETE CASCADE
);
```

### 3.5 后端API设计

#### 3.5.1 知识库管理API
```
# 知识库列表
GET    /api/v1/knowledge-bases
Query参数: page, size, keyword, userId

# 知识库详情
GET    /api/v1/knowledge-bases/{id}

# 创建知识库
POST   /api/v1/knowledge-bases
Body: { name, description, cover }

# 更新知识库
PUT    /api/v1/knowledge-bases/{id}
Body: { name, description, cover }

# 删除知识库
DELETE /api/v1/knowledge-bases/{id}

# 获取知识库下的文档列表
GET    /api/v1/knowledge-bases/{id}/documents
Query参数: page, size, keyword, parentId

# 复制知识库
POST   /api/v1/knowledge-bases/{id}/duplicate

# 归档知识库
PUT    /api/v1/knowledge-bases/{id}/archive
```

#### 3.5.2 文档管理API
```
# 文档列表
GET    /api/v1/documents
Query参数: page, size, keyword, userId, parentId

# 文档详情
GET    /api/v1/documents/{id}

# 创建文档
POST   /api/v1/documents
Body: { title, content, knowledgeBaseId, parentId }

# 更新文档
PUT    /api/v1/documents/{id}
Body: { title, content }

# 删除文档
DELETE /api/v1/documents/{id}

# 复制文档
POST   /api/v1/documents/{id}/duplicate

# 移动文档（在同一知识库内）
PUT    /api/v1/documents/{id}/move
Body: { parentId }

# 移动文档到其他知识库
PUT    /api/v1/documents/{id}/move-to-kb
Body: { knowledgeBaseId, parentId }
```

#### 3.5.3 用户认证API
```
# 用户登录
POST   /api/v1/auth/login
Body: { username/email, password }

# 用户注册
POST   /api/v1/auth/register
Body: { username, email, password }

# 用户登出
POST   /api/v1/auth/logout

# 刷新Token
POST   /api/v1/auth/refresh
```

#### 3.5.4 搜索API
```
# 搜索（知识库和文档）
GET    /api/v1/search
Query参数: keyword, type(kb/doc/all), page, size

# 在指定知识库内搜索文档
GET    /api/v1/knowledge-bases/{id}/search
Query参数: keyword, page, size
```

### 3.6 后端安全设计
- **JWT认证**: 使用JWT Token进行用户认证
- **密码加密**: 使用BCrypt加密存储密码
- **接口鉴权**: 基于Spring Security实现接口权限控制
- **CORS配置**: 配置跨域访问策略
- **SQL注入防护**: 使用MyBatis参数化查询
- **XSS防护**: 内容过滤和转义

## 4. 开发计划

### 第一阶段 - 前端基础功能（2周）
- [ ] 搭建React项目结构
- [ ] 实现登录/注册页面
- [ ] 实现知识库列表页面
- [ ] 实现知识库详情页（文档列表）
- [ ] 集成富文本编辑器
- [ ] 实现基础路由和状态管理
- [ ] 对接后端API接口

### 第二阶段 - 后端基础功能（2周）
- [ ] 搭建Spring Boot多模块项目
- [ ] 设计数据库表结构（知识库表、文档表）
- [ ] 实现用户认证授权
- [ ] 实现知识库CRUD接口
- [ ] 实现文档CRUD接口（关联知识库）
- [ ] 集成Redis缓存
- [ ] 编写API文档

### 第三阶段 - 功能完善（2周）
- [ ] 实现知识库树形结构
- [ ] 实现文档树形结构（知识库内）
- [ ] 实现文档在不同知识库间移动
- [ ] 实现知识库和文档搜索功能
- [ ] 实现文档版本管理
- [ ] 实现知识库和文档分享功能
- [ ] 优化前端UI/UX
- [ ] 性能优化

### 第四阶段 - 测试与部署（1周）
- [ ] 单元测试
- [ ] 集成测试
- [ ] 前端构建和部署
- [ ] 后端部署配置
- [ ] 生产环境部署

## 5. 部署方案

### 5.1 开发环境
- **前端**: Vite开发服务器，端口3000
- **后端**: Spring Boot内嵌Tomcat，端口8080
- **数据库**: 本地MySQL
- **缓存**: 本地Redis

### 5.2 生产环境
- **前端**: Nginx静态文件服务
- **后端**: Spring Boot打包为JAR，使用systemd管理
- **数据库**: MySQL主从架构
- **缓存**: Redis集群
- **反向代理**: Nginx
- **容器化**: Docker + Docker Compose（可选）

### 5.3 部署架构
```
Internet
   │
   ▼
[Nginx] (反向代理 + 静态文件)
   │
   ├───► [doc-web-app] (前端静态文件)
   │
   └───► [doc-server] (后端API服务)
           │
           ├───► [MySQL] (数据库)
           │
           └───► [Redis] (缓存)
```

## 6. 技术风险与应对

### 6.1 存储限制
- **问题**: 文档内容可能很大，数据库存储压力
- **解决**: 
  - 大文档内容存储到对象存储（MinIO/OSS）
  - 数据库只存储元数据和索引
  - 实现内容压缩

### 6.2 性能优化
- **问题**: 大量文档查询性能问题
- **解决**:
  - 使用Redis缓存热点数据
  - 数据库索引优化
  - 分页查询
  - 全文搜索使用Elasticsearch（可选）

### 6.3 并发编辑
- **问题**: 多用户同时编辑冲突
- **解决**:
  - 实现乐观锁机制
  - WebSocket实时同步（后续版本）
  - 操作日志记录

## 7. 扩展功能

### 7.1 协作功能
- 实时协作编辑（WebSocket）
- 评论和反馈系统
- 权限管理（查看、编辑、删除）
- 文档协作历史

### 7.2 高级功能
- 知识库模板系统
- 文档模板系统
- 导出功能（PDF、Word、Markdown）
- 知识库和文档标签和分类
- 全文搜索（Elasticsearch）
- 知识库和文档统计和分析
- 知识库权限管理（成员、角色）
- 插件系统

### 7.3 移动端支持
- 响应式设计优化
- PWA支持
- 移动端APP（React Native）
